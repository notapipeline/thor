
        <div class="ui hidden divider"></div>
        <div class="ui hidden divider"></div>
        <div class="ui hidden divider"></div>

        {{if eq $.Section "index"}}
            <div class="ui container">
                <div class="ui centered grid">
                    <div class="column">

                        <div class="center-aligned">
                            <div class="ui horizontal list">
                                <div class="item">&copy; Copyright &mdash; All Rights Reserved</div>
                            </div>

                            <div class="ui hidden clearing divider"></div>

                            <div class="ui horizontal divided list">
                                <a class="item" target="_blank" rel="noopener noreferrer" href="https://github.com/notapipeline/thor">Powered by Thor</a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        {{end}}
        <div class="ui modal">
            <div class="header">Enter token</div>
            <div class="content ui form input"><input type="password" name="token" placeholder="token" id="vaultToken" /></div>
            <div class="actions">
                <div class="ui button approve">OK</div>
            </div>
        </div>
        <script>
            $(document).ready(function() {
                $('.ui.dropdown').dropdown();
                $('.ui.checkbox').checkbox();
                var currentForm;
                var token = "";
                var modals = ["password", "employeeResults", "passwordResults"];
                var dialog = $('.modal').modal({
                    closable : false,
                    onApprove: function(){
                        var token = $("#vaultToken").val();
                        $('<input />').attr("type", "hidden")
                            .attr("name", "token")
                            .attr("value", token)
                            .appendTo(currentForm);

                        // If we're only carrying out search, just return and let
                        // the submission happen over normal http
                        var noAjax = ["employeeResults","passwordResults"];
                        if (!noAjax.includes(currentForm.id)) {
                            currentForm.submit();
                            return;
                        }

                        // When carrying out rotation, we want to bind a websocket
                        // for streaming log messages back from the server

                        var websocket = $.simpleWebSocket({
                            url: 'wss://{{ .WebSocket }}/api/v1/log'
                        });

                        // Send the list of hosts down the log websocket
                        // then listen for log messages streaming back
                        var hosts = [];
                        for (i = 0; i < currentForm.length; i++) {
                            if (currentForm[i].type == "checkbox" && currentForm[i].name != "" && currentForm[i].checked) {
                                hosts.push(currentForm[i].value.split('/').reverse()[0]);
                            }
                        }
                        websocket.send({hosts: hosts})
                        websocket.listen(function(message){
                            var elem = '<li><span class="time">' + message.time + '</span>'
                                + '<span class="host">' + message.host + '</span>'
                                + '<span class="logmessage">' + message.message + '</span></li>';
                            $("#logmessages").prepend(elem);
                            if (message.message === "Finished rotating password(s)") {
                                $('#log > i:first').remove();
                                $('#log').transition('fade').removeClass('red').addClass('green').transition('fade');
                            }
                        });

                        // finally submit the rotation information
                        // on success, clear the form.
                        $.ajax({
                            type: $(currentForm).attr('method'),
                            url:  $(currentForm).attr('action'),
                            data: $(currentForm).serialize(),
                            success: function (data) {
                                $('#results').empty();
                                $('#log').removeClass('hidden').addClass('red');
                            },
                            error: function (data) {
                                console.log('An error occurred.');
                            },
                        });
                    },
                });
                for (var form in modals) {
                    var id = 'form#'+modals[form];
                    if ($(id).length!= 0) {
                        $(id + ' .submit').click(function(e){
                            e.preventDefault();
                            e.stopPropagation();
                            currentForm = $(this).closest('form')[0];
                            dialog.modal('show');
                            return false;
                        });
                    }
                }

            {{ $pass := false }}
            {{ if $.Search.Results }}
                {{ $pass = eq $.Search.SearchType "password" }}
            {{ end }}


                $('.search .item').tab();
                var contents = {};
                var lastTab = "{{if $pass}}compromised{{else}}exemployee{{end}}";
                $('.search .item').on('click', function() {
                    var tab = $(this)[0].dataset.tab;
                    if (lastTab != tab) {
                        if ($('#results')) {
                            contents[lastTab] = $('#results').html();
                            $('#results').html('');
                            if (contents[tab]) {
                                $('#results').html(contents[tab]);
                            }
                        }
                        $('div.description > div.content').each(function() {
                            $(this).addClass('hidden');
                            $(this).css({'display': 'none'});
                        });
                        $('div.description > div.' + tab).removeClass('hidden');
                        $('div.description > div.' + tab).css({'display': 'block'});
                        lastTab = tab;
                    }
                });
                $('.results .item').tab();

                {{if $.Request.FormValue "success"}}
                    window.history.replaceState({}, document.title, window.location.href.split('?')[0]);
                {{end}}
                {{if $.Request.FormValue "error"}}
                    window.history.replaceState({}, document.title, window.location.href.split('?')[0]);
                {{end}}

                $('.confirm').on('click', function() {
                    return confirm($(this).data('prompt'));
                });
            });
        </script>
    </body>
</html>
